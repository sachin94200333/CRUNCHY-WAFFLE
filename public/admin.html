<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crunchy Waffle Admin Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-5 font-sans">
    <div class="max-w-4xl mx-auto space-y-8">
        <h1 class="text-3xl font-bold text-center text-red-600">Admin Dashboard</h1>

        <div class="bg-white p-6 rounded-lg shadow">
            <input type="password" id="adminPass" placeholder="Enter Admin Password (Crunchy123)" class="w-full p-3 border rounded text-lg font-bold border-red-300">
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4 border-b pb-2">Add New Waffle</h2>
            <div class="space-y-4">
                <input type="text" id="wName" placeholder="Waffle Name" class="w-full p-2 border rounded">
                <input type="number" id="wPrice" placeholder="Price" class="w-full p-2 border rounded">
                <input type="text" id="wDesc" placeholder="Description" class="w-full p-2 border rounded">
                <input type="text" id="wImg" placeholder="Image URL (ImgBB Direct Link)" class="w-full p-2 border rounded">
                <button onclick="addWaffle()" class="w-full bg-green-600 text-white py-3 rounded font-bold hover:bg-green-700">ADD WAFFLE</button>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4 border-b pb-2">Manage Menu</h2>
            <button onclick="loadWafflesForDelete()" class="bg-blue-500 text-white px-4 py-2 rounded mb-4 text-sm">Load Menu to Delete</button>
            <div id="deleteList" class="space-y-4"></div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow border-t-4 border-yellow-500">
            <h2 class="text-xl font-bold mb-4 text-yellow-600">Team & About Settings</h2>
            <div class="space-y-4">
                <input type="text" id="ceoName" placeholder="CEO Name" class="w-full p-2 border rounded">
                <input type="text" id="ceoPhoto" placeholder="CEO Photo URL" class="w-full p-2 border rounded">
                <input type="text" id="tm1Name" placeholder="Member 1 Name" class="w-full p-2 border rounded">
                <input type="text" id="tm1Photo" placeholder="Member 1 Photo URL" class="w-full p-2 border rounded">
                <input type="text" id="tm2Name" placeholder="Member 2 Name" class="w-full p-2 border rounded">
                <input type="text" id="tm2Photo" placeholder="Member 2 Photo URL" class="w-full p-2 border rounded">
                <textarea id="journey" placeholder="Our Journey Text..." class="w-full p-2 border rounded h-24"></textarea>
                <button onclick="updateAbout()" class="w-full bg-yellow-500 text-white py-3 rounded font-bold">UPDATE TEAM INFO</button>
            </div>
        </div>
    </div>

    <script>
        const passInput = document.getElementById('adminPass');

        async function addWaffle() {
            const data = {
                adminPassword: passInput.value,
                name: document.getElementById('wName').value,
                price: document.getElementById('wPrice').value,
                description: document.getElementById('wDesc').value,
                image: document.getElementById('wImg').value
            };
            const res = await fetch('/api/waffles', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            if(res.ok) { alert("Waffle Added!"); location.reload(); }
            else alert("Error! Check Password.");
        }

        async function loadWafflesForDelete() {
            const res = await fetch('/api/waffles');
            const waffles = await res.json();
            document.getElementById('deleteList').innerHTML = waffles.map(w => `
                <div class="flex justify-between items-center p-3 bg-gray-50 border rounded">
                    <span>${w.name} (‚Çπ${w.price})</span>
                    <button onclick="deleteWaffle('${w._id}')" class="bg-red-600 text-white px-3 py-1 rounded text-xs">DELETE</button>
                </div>
            `).join('');
        }

        async function deleteWaffle(id) {
            if(!confirm("Are you sure?")) return;
            const res = await fetch('/api/waffles/' + id, {
                method: 'DELETE',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ adminPassword: passInput.value })
            });
            if(res.ok) { alert("Deleted!"); loadWafflesForDelete(); }
            else alert("Error! Check Password.");
        }

        async function updateAbout() {
            const data = {
                adminPassword: passInput.value,
                ceoName: document.getElementById('ceoName').value,
                ceoPhoto: document.getElementById('ceoPhoto').value,
                tm1Name: document.getElementById('tm1Name').value,
                tm1Photo: document.getElementById('tm1Photo').value,
                tm2Name: document.getElementById('tm2Name').value,
                tm2Photo: document.getElementById('tm2Photo').value,
                journey: document.getElementById('journey').value
            };
            const res = await fetch('/api/about', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            if(res.ok) alert("Team Updated!");
            else alert("Error! Check Password.");
        }
    </script>
    <div class="max-w-4xl mx-auto p-6 bg-zinc-900 rounded-[2.5rem] border border-zinc-800 my-10 text-white">
    <h2 class="text-2xl font-black italic text-red-600 mb-2 uppercase">Live Logo Designer</h2>
    <p class="text-zinc-500 text-xs mb-8">Slider se size set karein aur Drag karke position.</p>

    <div class="grid md:grid-cols-2 gap-10">
        <div class="space-y-8">
            <div>
                <label class="block text-xs uppercase tracking-widest text-zinc-400 mb-4 font-bold">Logo Width (Size)</label>
                <input type="range" id="wSlider" min="50" max="600" value="200" class="w-full h-2 bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-red-600">
                <p class="text-right text-red-600 font-bold mt-2" id="wVal">200px</p>
            </div>
            <button onclick="saveLayout()" class="w-full bg-red-600 py-4 rounded-2xl font-black uppercase hover:scale-95 transition-all shadow-lg shadow-red-900/20">
                Save Final Layout
            </button>
        </div>

        <div class="relative h-64 bg-black rounded-3xl border-2 border-dashed border-zinc-800 flex items-center justify-center overflow-hidden" id="adminBoundary">
            <img id="previewLogo" src="/images/logo.png" class="absolute w-[100px] cursor-move touch-none">
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
<script>
    let posX = 0, posY = 0, currentWidth = 200;

    // Slider Logic: Size badalne ke liye
    const wSlider = document.getElementById('wSlider');
    wSlider.oninput = function() {
        currentWidth = this.value;
        document.getElementById('wVal').innerText = currentWidth + "px";
        document.getElementById('previewLogo').style.width = currentWidth + "px";
    };

    // Interact.js Logic: Logo hilane ke liye
    interact('#previewLogo').draggable({
        listeners: {
            move(event) {
                posX += event.dx;
                posY += event.dy;
                event.target.style.transform = `translate(${posX}px, ${posY}px)`;
            }
        },
        modifiers: [
            interact.modifiers.restrictRect({
                restriction: '#adminBoundary',
                endOnly: true
            })
        ]
    });

    // Save Logic: Server par permanently bhejane ke liye
    // 1. Save Function (Sirf ek baar)
    async function saveLayout() {
        const layoutData = {
            width: currentWidth + "px",
            x: posX + "px",
            y: posY + "px"
        };
        
        const res = await fetch('/api/save-logo', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(layoutData)
        });

        if(res.ok) alert("Duniya bhar ke liye settings save ho gayi! üåç");
    }
    if(res.ok) alert("Duniya bhar ke liye settings save ho gayi! üåç");
    // Ye saveLayout function ka aakhri bracket hai
</script>

</body>
</html>
</script>

    function saveLayout() {
        // Website ko variables bhejne ke liye
        const layoutData = {
            width: currentWidth + "px",
            x: posX + "px",
            y: posY + "px"
        };
        
        // LocalStorage mein save (Abhi ke liye)
        localStorage.setItem('crunchy_logo_layout', JSON.stringify(layoutData));
        
        alert("Layout Saved! Ab aapki website par logo yahin dikhega.");
        // Note: Real-time update ke liye humne index.html mein variables lagaye hain.
    }
</script>
</body>
</html>